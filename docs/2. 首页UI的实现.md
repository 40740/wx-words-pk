# 首页UI的实现

## 组件化开发

### 全局组件-顶部header

因为隐藏了小程序默认的全局header`"navigationStyle": "custom"`，所以需要自己实现一个高度一致的header顶部栏。

```js
// miniprogram/components/header/header.js
import $ from './../../utils/Tool'

Component({
  options: {
    addGlobalClass: true, // https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html#%E7%BB%84%E4%BB%B6%E6%A0%B7%E5%BC%8F%E9%9A%94%E7%A6%BB
    multipleSlots: true
  },
  data: {
    StatusBar: $.store.get('StatusBar'),
    CustomBar: $.store.get('CustomBar')
  }
})

```

```wxml
<!-- slot支持 -->
<view class="header" style="height:{{CustomBar}}px;padding-top:{{StatusBar}}px;">
  <view class="content" style="top:{{StatusBar}}px;">
    <slot name="content"></slot>
  </view>
</view>
```

```json
// app.json中全局引入
  "usingComponents": {
    "header": "/components/header/header"
  }
```

```wxml
<!-- home.wxml中直接使用 -->
<header><text slot="content" class="header-title">单词天天斗</text></header>
```

### 全局组件-弹窗message

```js
Component({
  options: {
    multipleSlots: true
  },
  data: {
    show: false
  },
  methods: {
    hide() { this.setData({ show: false }) },
    show() { this.setData({ show: true }) }
  }
})
```

```json
// app.json中引入
  "usingComponents": {
    "message": "/components/message/message"
  }
```

```wxml
<!-- bar.wxml中直接使用 -->
<message id="message">
  <view slot="content">
      <text style="color:#FF9C37;">提示卡</text><text>可在对战时给你提示单词释义哦！ 对战结束分享对战结果至群， 可以获得更多提示卡~ 感谢伙伴们支持~</text>
  </view>
</message>
```

```js
this.selectComponent('#message').show() // 父组件调用子组件方法，直接显示弹框
```

### 全局组件-loading

```wxml
<!-- loading.wxml -->
<view wx:if="{{show}}" class="mask" style="background-color:{{mask?'rgba(255, 255, 255, 0.4)':'transparent'}}">
  <view class="loading">
    <image src="./../../images/loading.png" class="loading-icon rotate time-2s" />
    <text class="loading-text">{{loadingText}}</text>
  </view>
</view>
```

```js
// Tool.js

function getLoaingObj() {
  const page = getCurrentPages()
  return page[page.length - 1].selectComponent('#loading')
}

// ...
loading(loadingText = '加载中···', mask = true) {
  const loading = getLoaingObj()
  loading.show(loadingText, mask)
},
hideLoading() {
  const loading = getLoaingObj()
  loading.hide()
}
// ...
```

全局app.json下引入loading组件，然后在需要有loading样式的页面引入，再调用Tool中的`loading`和`hideLoading`即可

```wxml
<loading id="loading"/>
```

### 首页组件-用户信息

```wxml
<view class="user">
  <open-data class="user-avatar" type="userAvatarUrl"></open-data>
  <view class="user-info">
    <open-data class="user-info__nickname" type="userNickName"></open-data>
    <view class="user-info__grade">
      <image class="grade-icon" src="./../../../../images/home-grade.png" />
      <text class="grade-text">词力值： {{grade}}</text>
    </view>
    <view class="user-info__fight-info">
      <view class="fight-info__pvp">
        <image class="pvp-icon" src="./../../../../images/home-pvp.png" />
        <text class="pvp-text">对战：{{pvpNumber}}局</text>
      </view>
      <view class="fight-info__win">
        <image class="win-icon" src="./../../../../images/home-win.png" />
        <text class="win-text">胜利：{{winNumber}}局</text>
      </view>
    </view>
  </view>
</view>
```

> CSS bem命名规范

### 首页组件-bar条

```wxml
<view class="bar">
  <view class="bar-tip" catchtap="onTip">
    <image class="bar-tip__icon" src="./../../../../images/home-tip.png" />
    <view class="bar-tip__text">
      <text class="tip-text__title">提示卡</text>
      <text class="tip-text__desc">{{tipNumber}}</text>
    </view>
  </view>
  <view class="bar-book" catchtap="onSelectBook">
    <image class="bar-book__icon" src="./../../../../images/home-book.png" />
    <view class="bar-book__text">
      <text class="book-text__title">单词书</text>
      <text class="book-text__desc">{{bookDesc}}</text>
    </view>
  </view>
</view>

<message id="message">
  <view slot="content">
      <text style="color:#FF9C37;">提示卡</text><text>可在对战时给你提示单词释义哦！ 对战结束分享对战结果至群， 可以获得更多提示卡~ 感谢伙伴们支持~</text>
  </view>
</message>

<book-select id="book-select" />
```

```js
// bar.js实现
const loadingText = '···'

Component({
  properties: {
    tipNumber: {
      type: String,
      value: loadingText,
      optionalTypes: [Number]
    },
    bookDesc: {
      type: String,
      value: loadingText
    }
  },
  methods: {
    onSelectBook() {
      this.selectComponent('#book-select').show()
    },
    onTip() {
      this.selectComponent('#message').show()
    }
  }
})
```

### 首页组件-选择单词本

引入动画库？

### 首页组件-按钮区域

### 首页组件-底部

### 首页组件-添加到小程序提示

怎么快速接入？怎么利用已有开源？

## 涉及知识点

- 小程序slot

- 父组件调用子组件方法

- CSS命名规范

- 引入动画库

- 如何找到开源插件

- 图片mode使用widthFix的问题
